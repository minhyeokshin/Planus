<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
	<title>íšŒì›ê°€ì…</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" th:href="@{/static/css/app.css}" />
	<link rel="stylesheet" th:href="@{/static/css/custom.css}" />
	<script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
	<style>
  body {
    font-family: 'Helvetica Neue', Arial, sans-serif;
    background: linear-gradient(135deg, #e0eafc, #cfdef3);
    margin: 0;
    padding: 0;
  }

  .signup-container {
    width: 100%;
    max-width: 480px;
    margin: 80px auto;
    padding: 40px;
    background: white;
    border-radius: 12px;
    box-shadow: 0 12px 30px rgba(0, 0, 0, 0.1);
    animation: fadeIn 0.7s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .signup-container h2 {
    margin-bottom: 24px;
    color: #222;
    font-size: 30px;
    text-align: center;
    font-weight: 700;
  }

  .form-label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #333;
  }

  .form-control {
    width: 100%;
    padding: 14px;
    margin-bottom: 16px;
    border: 1px solid #ccc;
    border-radius: 6px;
    font-size: 15px;
    transition: all 0.3s;
  }

  .form-control:focus {
    border-color: #007bff;
    box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.25);
    outline: none;
  }

  .btn-submit {
    width: 100%;
    padding: 14px;
    background-color: #007bff;
    color: white;
    border: none;
    border-radius: 6px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }

  .btn-submit:hover {
    background-color: #0056b3;
  }

  .form-text {
    font-size: 12px;
    color: #777;
    margin-top: -12px;
    margin-bottom: 16px;
  }

  .text-danger {
    color: #dc3545 !important;
  }

  .phone-input-group {
    display: flex;
    gap: 8px;
  }

  .phone-input-group select,
  .phone-input-group input {
    flex: 1;
    padding: 12px;
    border: 1px solid #ccc;
    border-radius: 6px;
    font-size: 14px;
  }

  @media (max-width: 576px) {
    .signup-container {
      padding: 20px;
      margin: 40px auto;
    }

    .btn-submit {
      padding: 12px;
      font-size: 14px;
    }
  }
  </style>
</head>
<body class="bg-light">

<main class="d-flex w-100 justify-content-center align-items-center" style="min-height: 100vh;">
	<div class="signup-container">
		<h2>íšŒì›ê°€ì…</h2>
		<form id="signupForm" th:action="@{/signup}" th:object="${user}" method="post">
			<div class="mb-3">
				<label class="form-label">ID</label>
				<input type="text" class="form-control" th:field="*{loginId}" placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”" maxlength="12" pattern="[a-zA-Z0-9]{4,12}" required />
				<div class="form-text">(ì˜ë¬¸ê³¼ ìˆ«ì ì¡°í•©, 4~12ì)</div>
				<div class="form-text" id="userIdCheckMessage"></div>
				<div th:if="${msg != null}" class="form-text text-danger" th:text="${msg}"></div>
			</div>
			<div class="mb-3">
				<label class="form-label">ì´ë©”ì¼</label>
				<input type="email" class="form-control" th:field="*{email}" placeholder="example@email.com" required />
			</div>
			<div class="mb-3">
				<label class="form-label">ê·¸ë£¹ ID</label>
				<input type="number" class="form-control" th:field="*{groupId}" placeholder="ê·¸ë£¹ ID" required />
				<div class="form-text" id="groupIdCheckMessage"></div>
			</div>
			<div class="mb-3">
				<label class="form-label">ë¹„ë°€ë²ˆí˜¸</label>
				<input type="password" class="form-control" th:field="*{password}" id="userPw" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" pattern="(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&]).{8,15}" required />
				<div class="form-text">(ì˜ë¬¸, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ì í¬í•¨ 8~15ì)</div>
			</div>
			<div class="mb-3">
				<label class="form-label">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
				<input type="password" class="form-control" th:field="*{password}" id="userPwConfirm" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ ì…ë ¥í•˜ì„¸ìš”" required />
				<div class="form-text" id="passwordMatchMessage"></div>
				<div id="pwCheckMsg" class="form-text text-danger" style="display:none;">
					â— ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
				</div>
			</div>
			<div class="mb-3">
				<label class="form-label">ì´ë¦„</label>
				<input type="text" class="form-control" th:field="*{username}" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" required />
			</div>
			<div class="mb-3">
				<label class="form-label">ì—°ë½ì²˜</label>
				<div class="phone-input-group">
					<select class="form-control d-inline-block" th:field="*{userPhone1}" required>
						<option value="010">010 (íœ´ëŒ€í°)</option>
						<option value="070">070 (ì¸í„°ë„·ì „í™”)</option>
						<option value="050">050 (ì•ˆì‹¬ë²ˆí˜¸)</option>
					</select>
					<input type="text" class="form-control d-inline-block" th:field="*{userPhone2}" maxlength="4" placeholder="0000" pattern="\d{3,4}" required />
					<input type="text" class="form-control d-inline-block" th:field="*{userPhone3}" maxlength="4" placeholder="0000" pattern="\d{4}" required />
				</div>
				<input type="hidden" th:field="*{phone}" id="userPhone" />
			</div>
<!--			<div class="mb-3">-->
<!--				<label class="form-label">ì£¼ì†Œ</label>-->
<!--				<input type="text" class="form-control" id="userAddressSearch" placeholder="ì£¼ì†Œ ê²€ìƒ‰ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”" readonly required th:value="${userAddressSearch}" />-->
<!--				<button type="button" id="btn-search-address" class="btn btn-sm btn-secondary mt-2">ì£¼ì†Œ ê²€ìƒ‰</button>-->
<!--			</div>-->
<!--			<div class="mb-3">-->
<!--				<label class="form-label">ìƒì„¸ ì£¼ì†Œ</label>-->
<!--				<input type="text" class="form-control" id="userAddressDetail" placeholder="ìƒì„¸ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”" required th:value="${userAddressDetail}" />-->
<!--			</div>-->
<!--			<input type="hidden" th:field="*{userAddress}" id="userAddress" />-->
<!--			<div class="mb-4">-->
<!--				<label class="form-label">ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸</label>-->
<!--				<input type="text" class="form-control" th:field="*{businessNumber}" placeholder="000-00-00000" pattern="^\d{3}-\d{2}-\d{5}$" required />-->
<!--				<div class="form-text">000-00-00000 í˜•ì‹</div>-->
<!--			</div>-->
			<div class="d-grid">
				<button type="submit" class="btn btn-primary btn-submit">íšŒì›ê°€ì…</button>
			</div>
		</form>
	</div>
</main>

<script>
	// ì£¼ì†Œ ê²€ìƒ‰ ê¸°ëŠ¥
	document.getElementById("btn-search-address").addEventListener("click", function () {
		new daum.Postcode({
			oncomplete: function (data) {
				document.getElementById("userAddressSearch").value = data.address;
			}
		}).open();
	});

	// í¼ ì œì¶œ ì „ ì „í™”ë²ˆí˜¸ ì¡°í•© ë° ë¹„ë°€ë²ˆí˜¸ í™•ì¸
	document.addEventListener("DOMContentLoaded", function() {
		const form = document.getElementById("signupForm");
		form.addEventListener("submit", function(e) {
			// ë¹„ë°€ë²ˆí˜¸ í™•ì¸
			const pw = document.getElementById("userPw").value;
			const pwConfirm = document.getElementById("userPwConfirm").value;
			const pwCheckMsg = document.getElementById("pwCheckMsg");
			if (pw !== pwConfirm) {
				pwCheckMsg.style.display = "block";
				e.preventDefault();
				return;
			} else {
				pwCheckMsg.style.display = "none";
			}

			// ì£¼ì†Œ í•©ì¹˜ê¸°
			const searchAddr = document.getElementById("userAddressSearch").value;
			const detailAddr = document.getElementById("userAddressDetail").value;
			document.getElementById("userAddress").value = searchAddr + " " + detailAddr;

			// ì „í™”ë²ˆí˜¸ ì¡°í•© ë° hidden ë®ì–´ì“°ê¸°
			const p1 = document.querySelector('select[name="userPhone1"]').value;
			const p2 = document.querySelector('input[name="userPhone2"]').value;
			const p3 = document.querySelector('input[name="userPhone3"]').value;
			document.getElementById("userPhone").value = p1 + "-" + p2 + "-" + p3;
		});
	});
</script>
<script>
	document.addEventListener("DOMContentLoaded", function () {
		const pw = document.getElementById("userPw");
		const confirmPw = document.getElementById("userPwConfirm");
		const msg = document.getElementById("passwordMatchMessage");

		function checkPasswordMatch() {
			if (confirmPw.value === "") {
				msg.textContent = "";
				return;
			}

			if (pw.value === confirmPw.value) {
				msg.textContent = "âœ… ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•©ë‹ˆë‹¤.";
				msg.style.color = "green";
			} else {
				msg.textContent = "âŒ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.";
				msg.style.color = "red";
			}
		}

		pw.addEventListener("input", checkPasswordMatch);
		confirmPw.addEventListener("input", checkPasswordMatch);
	});
</script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const userIdInput = document.querySelector('input[name="userId"]');
    const messageBox = document.getElementById("userIdCheckMessage");

    if (userIdInput && messageBox) {
      userIdInput.addEventListener("input", function () {
        const userId = this.value;
        if (userId.length < 4) {
          messageBox.textContent = "";
          return;
        }

        fetch(`/api/check-userid?userId=${encodeURIComponent(userId)}`)
          .then(res => res.json())
          .then(data => {
            if (data.exists) {
              messageBox.textContent = "âŒ ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ IDì…ë‹ˆë‹¤.";
              messageBox.style.color = "red";
            } else {
              messageBox.textContent = "âœ… ì‚¬ìš© ê°€ëŠ¥í•œ IDì…ë‹ˆë‹¤.";
              messageBox.style.color = "green";
            }
          });
      });
    }
  });
</script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const groupIdInput = document.querySelector('input[name="groupId"]');
    const messageBox = document.getElementById("groupIdCheckMessage");

    if (groupIdInput && messageBox) {
      groupIdInput.addEventListener("input", function () {
        const groupId = this.value;
        if (groupId.length < 2) {
          messageBox.textContent = "";
          return;
        }

        fetch(`/api/check-groupId?groupId=${encodeURIComponent(groupId)}`)
          .then(res => res.json())
          .then(data => {
            if (data.exists) {
              messageBox.textContent = "âœ… ë“±ë¡ ê°€ëŠ¥í•œ ê·¸ë£¹ IDì…ë‹ˆë‹¤.";
              messageBox.style.color = "green";
            } else {
              messageBox.innerHTML = `
    âŒ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê·¸ë£¹ì…ë‹ˆë‹¤.<br>
    ğŸ‘‰ <a href="/groupsignup" target="_blank"  style="color:red; text-decoration:underline;">[ê·¸ë£¹ ë“±ë¡ í˜ì´ì§€ë¡œ ì´ë™]</a>
  `;
              // Do not set messageBox.style.color here to avoid overriding the link color
            }
          });
      });
    }
  });
</script>
<script th:src="@{/static/js/app.js}"></script>
</script>
<script th:inline="javascript">
  /*<![CDATA[*/
  let msg = /*[[${msg}]]*/ null;
  if (msg !== null && msg !== 'null') {
    alert(msg);
  }
  /*]]>*/
</script>
</body>
</html>